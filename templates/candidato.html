{% load static %}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firma Digital de Contrato - SignApp</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
</head>
<body class="container-fluid mt-2" style="background-color: #f5f4ea;">

    <nav class="container-fluid bg-white p-3 mb-3 rounded shadow-sm">
        <ul class="container-fluid d-flex align-items-center">
            <span class="app-name me-auto" style="color:goldenrod; font-size: 40px; font-family:Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;">
                Almar: Proceso de Contratación
            </span>
            <img class="ms-auto mt-2" src="{% static 'images/logo.png' %}" height="100" alt="Logo">
        </ul>       
    </nav>

    <div class="content-wrapper">
        <div class="container">
            <div class="form-card bg-white p-2 rounded shadow-sm">
                <h2 class="mb-3">Firma de Contrato Laboral</h2>
                
                {% if error %}
                    <div class="alert alert-danger">{{ error }}</div>
                {% endif %}

                <p class="mb-2">
                    Este enlace es personal y tiene una vigencia limitada.
                    Válido hasta el 
                    <strong>{{ proceso.expira|date:"d/m/Y H:i" }}</strong>.
                </p>

                <div class="alert alert-info">
                    <p class="mb-1">
                        Antes de firmar, por favor revise el documento de contrato asociado a su proceso:
                    </p>
                    {% if proceso.pdf_empresa %}
                    <a href="{{ proceso.pdf_empresa.url }}" target="_blank" class="btn btn-sm btn-primary">
                        Ver / Descargar contrato en PDF
                    </a>
                    {% elif proceso.plantilla and proceso.plantilla.archivo %}
                    <a href="{{ proceso.plantilla.archivo.url }}" target="_blank" class="btn btn-sm btn-primary">
                        Ver / Descargar contrato en PDF
                    </a>
                    {% else %}
                    <p class="mb-0 text-danger">
                        No se encontró el contrato base asociado a este proceso.
                        Por favor, contacte a Recursos Humanos.
                    </p>
                    {% endif %}

                </div>

                <p>
                    Para completar su proceso de contratación, suba una <strong>imagen de su firma</strong> y acepte el consentimiento.
                    El sistema se encargará de estampar su firma sobre el contrato seleccionado por Recursos Humanos.
                </p>

                <form method="post" enctype="multipart/form-data" class="mt-3">
                    {% csrf_token %}

                    <fieldset class="mb-3">
                        <legend class="h5 mb-3">Firma Digital</legend>
                        
                        <div class="mb-3">
                            <label for="{{ form.firma_img.id_for_label }}" class="form-label">
                                1. Fotografía o archivo de su firma en formato PNG o JPG, se recomienda fondo blanco:
                            </label>
                            {{ form.firma_img }}
                            {% if form.firma_img.errors %}
                                <div class="text-danger small mt-1">
                                    {{ form.firma_img.errors }}
                                </div>
                            {% endif %}
                        </div>
                    </fieldset>

                    <div class="mb-3 form-check">
                        {{ form.consentimiento }}
                        <label for="{{ form.consentimiento.id_for_label }}" class="form-check-label">
                            {{ form.consentimiento.label }}
                        </label>

                        {% if form.consentimiento.errors %}
                            <div class="text-danger small mt-1">
                                {{ form.consentimiento.errors }}
                            </div>
                        {% endif %}

                        <br>

                        {{ form.confirmacion }}
                        <label for="{{ form.confirmacion.id_for_label }}" class="form-check-label">
                            {{ form.confirmacion.label }}
                        </label>

                        {% if form.confirmacion.errors %}
                            <div class="text-danger small mt-1">
                                {{ form.confirmacion.errors }}
                            </div>
                        {% endif %}
                    </div>

                    
                    <div class="form-actions mt-4 mb-2 d-flex justify-content-center">
                        <button type="submit" class="btn btn-success">
                            Procesar y Firmar Contrato
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <footer class="text-center mt-3 mb-1 p-3 bg-dark rounded" style="color:#FFE4C4; font-size:25px; font-weight:400; font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif">
        Almar Ltda. &copy; {% now "Y" %}. Todos los derechos reservados.
    </footer>
</body>
</html>
